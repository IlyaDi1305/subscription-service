# üì¶ Subscription Service (Spring Boot + PostgreSQL + Docker)

–ú–∏–∫—Ä–æ—Å–µ—Ä–≤–∏—Å –¥–ª—è —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è–º–∏ –∏ –∏—Ö –ø–æ–¥–ø–∏—Å–∫–∞–º–∏ –Ω–∞ —Ü–∏—Ñ—Ä–æ–≤—ã–µ —Å–µ—Ä–≤–∏—Å—ã (Netflix, –Ø–Ω–¥–µ–∫—Å.–ü–ª—é—Å –∏ –¥—Ä).

## –¢–µ—Ö–Ω–æ–ª–æ–≥–∏–∏

- Java 17
- Spring Boot 3 (Web, Data JPA, Validation, Cache)
- PostgreSQL
- Hibernate
- Docker + Docker Compose
- Swagger (SpringDoc OpenAPI)
- SLF4J (–ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ)
- JUnit + MockMvc (—Ç–µ—Å—Ç—ã –∫–æ–Ω—Ç—Ä–æ–ª–ª–µ—Ä–æ–≤)
- Grafana + Prometheus
---

## ‚úÖ –†–µ–∞–ª–∏–∑–æ–≤–∞–Ω–æ

### –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏ (`/api/v1/users`)
- `POST /` ‚Äî —Å–æ–∑–¥–∞–Ω–∏–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
- `GET /{id}` ‚Äî –ø–æ–ª—É—á–∏—Ç—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
- `PUT /{id}` ‚Äî –æ–±–Ω–æ–≤–∏—Ç—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
- `DELETE /{id}` ‚Äî —É–¥–∞–ª–∏—Ç—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è

### –ü–æ–¥–ø–∏—Å–∫–∏ (`/api/v1/users/{userId}/subscriptions`)
- `POST /` ‚Äî –¥–æ–±–∞–≤–∏—Ç—å –ø–æ–¥–ø–∏—Å–∫—É
- `GET /` ‚Äî –ø–æ–ª—É—á–∏—Ç—å –≤—Å–µ –ø–æ–¥–ø–∏—Å–∫–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
- `DELETE /{subId}` ‚Äî —É–¥–∞–ª–∏—Ç—å –ø–æ–¥–ø–∏—Å–∫—É

### –¢–û–ü –ø–æ–¥–ø–∏—Å–æ–∫
- `GET /api/v1/subscriptions/top` ‚Äî –ø–æ–ª—É—á–∏—Ç—å —Ç–æ–ø-3 –ø–æ–ø—É–ª—è—Ä–Ω—ã—Ö –ø–æ–¥–ø–∏—Å–æ–∫

---

## –ö—ç—à–∏—Ä–æ–≤–∞–Ω–∏–µ

–ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –≤—Å—Ç—Ä–æ–µ–Ω–Ω–æ–µ –∫–µ—à–∏—Ä–æ–≤–∞–Ω–∏–µ Spring (`@EnableCaching`) 

–î–ª—è –∫—ç—à–∞ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è `ConcurrentMapCacheManager` (–º–æ–∂–Ω–æ –∑–∞–º–µ–Ω–∏—Ç—å –Ω–∞ Redis –ø—Ä–∏ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ—Å—Ç–∏).

---

## –û–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫

- –ì–ª–æ–±–∞–ª—å–Ω—ã–π `@RestControllerAdvice` —Å –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ–º –æ—à–∏–±–æ–∫
- –û–±—Ä–∞–±–æ—Ç–∫–∞:
    - `@Valid` –≤–∞–ª–∏–¥–∞—Ü–∏–∏
    - `EntityNotFoundException`
    - –¥—Ä—É–≥–∏—Ö `RuntimeException`

---

## –¢–µ—Å—Ç—ã

- –ö–æ–Ω—Ç—Ä–æ–ª–ª–µ—Ä—ã –ø–æ–∫—Ä—ã—Ç—ã `@WebMvcTest`
- –ü—Ä–æ–≤–µ—Ä—è–µ—Ç—Å—è –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ—Å—Ç—å HTTP-–æ—Ç–≤–µ—Ç–æ–≤, —Ç–µ–ª–∞, —Å—Ç–∞—Ç—É—Å–æ–≤ –∏ –≤–∞–ª–∏–¥–∞—Ü–∏–∏

---

## üóÇ –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ

- –í—Å–µ –¥–µ–π—Å—Ç–≤–∏—è –ª–æ–≥–∏—Ä—É—é—Ç—Å—è —á–µ—Ä–µ–∑ `SLF4J` (—É—Ä–æ–≤–Ω–∏: info, debug, warn, error)
- –ü–æ–¥–¥–µ—Ä–∂–∫–∞ –ª–æ–≥–æ–≤ –≤ –∫–æ–Ω—Å–æ–ª—å –∏ —Ñ–∞–π–ª (logback)

---

## ‚öôÔ∏è Docker 
–î–ª—è –±—ã—Å—Ç—Ä–æ–≥–æ —Ä–∞–∑–≤–µ—Ä—Ç—ã–≤–∞–Ω–∏—è
- `Dockerfile` –∏ `docker-compose.yml` 
        
---
## CI/CD
#### –ü—Ä–æ–µ–∫—Ç –∏—Å–ø–æ–ª—å–∑—É–µ—Ç GitHub Actions –¥–ª—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–π —Å–±–æ—Ä–∫–∏, —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è –∏ –¥–µ–ø–ª–æ—è Docker-–æ–±—Ä–∞–∑–∞.

–ß—Ç–æ –¥–µ–ª–∞–µ—Ç workflow:
–ó–∞–ø—É—Å–∫–∞–µ—Ç—Å—è –ø—Ä–∏ –ø—É—à–µ –≤ `main` –∏–ª–∏ `master`.

–ü–æ–¥–Ω–∏–º–∞–µ—Ç PostgreSQL –≤ CI-—Å—Ä–µ–¥–µ.

–°–æ–±–∏—Ä–∞–µ—Ç –ø—Ä–æ–µ–∫—Ç –∏ –∑–∞–ø—É—Å–∫–∞–µ—Ç JUnit-—Ç–µ—Å—Ç—ã (`mvn clean verify`).

–°–æ–±–∏—Ä–∞–µ—Ç Docker-–æ–±—Ä–∞–∑ –∏ –ø—É—à–∏—Ç –µ–≥–æ –≤ `Docker Hub`.

–§–∞–π–ª workflow:
`.github/workflows/docker.yml`

–¢—Ä–µ–±—É–µ—Ç—Å—è:
–î–æ–±–∞–≤–∏—Ç—å –≤ GitHub Secrets:

`DOCKER_USERNAME` ‚Äî –ª–æ–≥–∏–Ω Docker Hub

`DOCKER_PASSWORD` ‚Äî —Ç–æ–∫–µ–Ω –∏–ª–∏ –ø–∞—Ä–æ–ª—å –æ—Ç Docker Hub

---

## üìä –ú–µ—Ç—Ä–∏–∫–∏ –∏ –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥
####   –í –ø—Ä–æ–µ–∫—Ç–µ –ø–æ–¥–∫–ª—é—á—ë–Ω Spring Boot Actuator –∏ –ø–æ–¥–¥–µ—Ä–∂–∫–∞ Prometheus + Grafana:

##### –ú–∏–∫—Ä–æ—Å–µ—Ä–≤–∏—Å –ø—Ä–µ–¥–æ—Å—Ç–∞–≤–ª—è–µ—Ç –º–µ—Ç—Ä–∏–∫–∏ –≤ —Ñ–æ—Ä–º–∞—Ç–µ Prometheus –ø–æ –∞–¥—Ä–µ—Å—É:
    `http://localhost:8081/actuator/prometheus`

### Grafana
–ü–æ–¥–∫–ª—é—á–∏ Prometheus –∫–∞–∫ –∏—Å—Ç–æ—á–Ω–∏–∫ –¥–∞–Ω–Ω—ã—Ö –≤ Grafana.

–ò–º–ø–æ—Ä—Ç–∏—Ä—É–π –≥–æ—Ç–æ–≤—ã–π JVM Dashboard (–Ω–∞–ø—Ä–∏–º–µ—Ä, ID 4701) –∏–ª–∏ —Å–æ–∑–¥–∞–π —Å–æ–±—Å—Ç–≤–µ–Ω–Ω—ã–π

![img.png](img.png)

---
## –í –±—É–¥—É—â–µ–º –º–æ–∂–Ω–æ –¥–æ–±–∞–≤–∏—Ç—å

- **JWT-–∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏—é**
    - –ê–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è —á–µ—Ä–µ–∑ `Authorization: Bearer <token>`
    - –†–æ–ª–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π (USER / ADMIN)
    - –û–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–µ –¥–æ—Å—Ç—É–ø–∞ –∫ —ç–Ω–¥–ø–æ–∏–Ω—Ç–∞–º

- **Rate Limiting** (–æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–µ —á–∞—Å—Ç–æ—Ç—ã –∑–∞–ø—Ä–æ—Å–æ–≤)

- **–ö–µ—à –≤ Redis** –≤–º–µ—Å—Ç–æ –≤—Å—Ç—Ä–æ–µ–Ω–Ω–æ–≥–æ

- **OpenTelemetry / Tracing**

- **API Key –∑–∞—â–∏—Ç–∞** –¥–ª—è –≤–Ω—É—Ç—Ä–µ–Ω–Ω–∏—Ö –º–∏–∫—Ä–æ—Å–µ—Ä–≤–∏—Å–æ–≤

---

## –õ–æ–∫–∞–ª—å–Ω—ã–π –∑–∞–ø—É—Å–∫ –ø—Ä–æ–µ–∫—Ç–∞
## –¢—Ä–µ–±–æ–≤–∞–Ω–∏—è:
Java 17+

Maven 3.8+

Docker –∏ Docker Compose

‚úÖ –®–∞–≥–∏ –∑–∞–ø—É—Å–∫–∞:
1. –ö–ª–æ–Ω–∏—Ä—É–π —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–π
```basch
   git clone https://github.com/IlyaDi1305/subscription-service
   cd subscription-service
```

–ü–æ—Å–ª–µ –∫–ª–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏—è, –ø–µ—Ä–µ–π–¥–∏ –≤ –ø–∞–ø–∫—É –ø—Ä–æ–µ–∫—Ç–∞ –∏ –≤—ã–ø–æ–ª–Ω–∏ –∫–æ–º–∞–Ω–¥—É:
```basch 
    mvn clean package
```
2. –ó–∞–ø—É—Å—Ç–∏ –±–∞–∑—É –¥–∞–Ω–Ω—ã—Ö –∏ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ
```basch
   docker-compose up --build
```
### –≠—Ç–æ –ø–æ–¥–Ω–∏–º–µ—Ç:

#### PostgreSQL –∏ Spring Boot –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ 

3. –ü—Ä–æ–≤–µ—Ä—å, —á—Ç–æ –≤—Å—ë —Ä–∞–±–æ—Ç–∞–µ—Ç
   –û—Ç–∫—Ä–æ–π –±—Ä–∞—É–∑–µ—Ä –∏ –ø–µ—Ä–µ–π–¥–∏ –Ω–∞:

```basch
http://localhost:8081/swagger-ui/index.html#/
```

#### –¢—ã —É–≤–∏–¥–∏—à—å Swagger-–∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å —Å –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏–µ–π –∏ –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç—å—é —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å API.

4. –ü—Ä–∏–º–µ—Ä –∑–∞–ø—Ä–æ—Å–∞ –Ω–∞ —Å–æ–∑–¥–∞–Ω–∏–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è (—á–µ—Ä–µ–∑ curl):

```basch
   curl -X POST http://localhost:8081/api/v1/users \
   -H "Content-Type: application/json" \
   -d '{"name": "–ò–≤–∞–Ω", "email": "ivan@example.com"}'
```
5. –î–ª—è –æ—Å—Ç–∞–Ω–æ–≤–∫–∏:
```basch
    docker-compose down
```

---

## üìñ Swagger UI

–ü–æ—Å–ª–µ –∑–∞–ø—É—Å–∫–∞ –¥–æ—Å—Ç—É–ø–µ–Ω –ø–æ –∞–¥—Ä–µ—Å—É:
http://localhost:8081/swagger-ui/index.html#/

##  –ë—ã—Å—Ç—Ä—ã–π —Ç–µ—Å—Ç —á–µ—Ä–µ–∑ Swagger

1. –û—Ç–∫—Ä–æ–π Swagger UI
2. –ù–∞–∂–º–∏ –Ω–∞ `POST /api/v1/users` ‚Üí Try it out
3. –°–æ–∑–¥–∞–π –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è:
```json
{
  "name": "–ò–≤–∞–Ω",
  "email": "ivan@example.com"
}
```
4. –ò—Å–ø–æ–ª—å–∑—É–π id –∏–∑ –æ—Ç–≤–µ—Ç–∞ –≤ /users/{id}/subscriptions
